console.log("ðŸŸ¢ background.js LOADED!"),chrome.runtime.onMessage.addListener((function(e,o,n){const s=e.highlightedText,t=/[^\w\s]/g,r=/[a-zA-z]{2,4}([-\s]|(&nbsp;))[0-9]{3,4}/.exec(s);if(r)try{const e=r[0].replace(t," ").trim().toLocaleUpperCase().split(/\s|&nbsp;/);3===e[1].length&&(e[1]+="0");const o={inputcourse:e[0]+"-"+e[1]};chrome.storage.local.set(o,(()=>{console.log("Input course saved")}))}catch(e){console.log(e)}})),chrome.runtime.onMessage.addListener(((e,o,n)=>{if(console.log("ðŸ”” background.onMessage got:",e),"getAiSelection"===e.action)return chrome.storage.local.get(["openaiKey"],(async({openaiKey:o})=>{if(!o)return void n({error:"No OpenAI key saved"});const s={role:"system",content:"You are a helpful academic advisor for Penn undergrads."},t={role:"user",content:`Here are the courses Iâ€™m interested in: ${e.courses.map((e=>`â€¢ ${e.id}: ${e.title}`)).join("\n")} \n        Based on workload, difficulty, and quality averages, which one would you recommend I take this coming semester? Explain briefly.`.trim()};try{const e=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({model:"gpt-4",messages:[s,t],max_tokens:200})}),r=await e.json(),a=r.choices?.[0]?.message?.content||"No response";n({answer:a})}catch(e){console.error(e),n({answer:"Error calling OpenAI."})}})),!0}));